<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åç«¯è¿é€šæ€§æµ‹è¯•</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #45a049;
    }
    .result {
      margin-top: 10px;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ AutoDL åç«¯è¿é€šæ€§æµ‹è¯•</h1>
  
  <div class="test-section">
    <h3>1. æµ‹è¯•åç«¯å¥åº·æ£€æŸ¥</h3>
    <button onclick="testHealth()">æµ‹è¯• /health</button>
    <button onclick="testRoot()">æµ‹è¯• / (æ ¹è·¯å¾„)</button>
    <div id="health-result" class="result"></div>
  </div>

  <div class="test-section">
    <h3>2. æµ‹è¯• API åœ°å€é…ç½®</h3>
    <button onclick="checkConfig()">æ£€æŸ¥å‰ç«¯é…ç½®</button>
    <div id="config-result" class="result"></div>
  </div>

  <div class="test-section">
    <h3>3. æµ‹è¯•æ–‡ä»¶ä¸Šä¼ æ¥å£</h3>
    <input type="file" id="test-file" accept="image/*">
    <button onclick="testUpload()">æµ‹è¯•ä¸Šä¼ </button>
    <div id="upload-result" class="result"></div>
  </div>

  <script>
    // ä» Vite ç¯å¢ƒå˜é‡è¯»å– API åœ°å€
    const API_BASE = 'http://localhost:6008';
    
    function showResult(elementId, message, type = 'info') {
      const el = document.getElementById(elementId);
      el.className = `result ${type}`;
      el.textContent = message;
    }

    async function testHealth() {
      showResult('health-result', 'æ­£åœ¨æµ‹è¯•...', 'info');
      try {
        const response = await fetch(`${API_BASE}/health`);
        const data = await response.json();
        showResult('health-result', 
          `âœ… åç«¯å¥åº·æ£€æŸ¥æˆåŠŸï¼\nå“åº”: ${JSON.stringify(data, null, 2)}\nçŠ¶æ€ç : ${response.status}`, 
          'success'
        );
      } catch (error) {
        showResult('health-result', 
          `âŒ åç«¯è¿æ¥å¤±è´¥ï¼
é”™è¯¯: ${error.message}

æ£€æŸ¥é¡¹ï¼š
1. åç«¯æ˜¯å¦å¯åŠ¨ï¼Ÿè¿è¡Œ: ps aux | grep uvicorn
2. ç«¯å£æ˜¯å¦æ­£ç¡®ï¼Ÿåº”è¯¥æ˜¯ 6008
3. é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ï¼Ÿ`, 
          'error'
        );
      }
    }

    async function testRoot() {
      showResult('health-result', 'æ­£åœ¨æµ‹è¯•...', 'info');
      try {
        const response = await fetch(`${API_BASE}/`);
        const data = await response.json();
        showResult('health-result', 
          `âœ… æ ¹è·¯å¾„è®¿é—®æˆåŠŸï¼\nå“åº”: ${JSON.stringify(data, null, 2)}`, 
          'success'
        );
      } catch (error) {
        showResult('health-result', 
          `âŒ æ ¹è·¯å¾„è®¿é—®å¤±è´¥ï¼\né”™è¯¯: ${error.message}`, 
          'error'
        );
      }
    }

    function checkConfig() {
      const info = `
å½“å‰é…ç½®ä¿¡æ¯ï¼š
===================
API_BASE: ${API_BASE}
API_BASE_URL: ${API_BASE}/api/v1

ä¸Šä¼ æ¥å£å®Œæ•´åœ°å€: ${API_BASE}/api/v1/clothes/upload

è¯·ç¡®è®¤ï¼š
1. åç«¯åœ¨ 0.0.0.0:6008 ç›‘å¬
2. Vite proxy é…ç½®æ­£ç¡®
3. CORS ç™½åå•åŒ…å«å‰ç«¯åœ°å€
      `;
      showResult('config-result', info, 'info');
    }

    async function testUpload() {
      const fileInput = document.getElementById('test-file');
      if (!fileInput.files.length) {
        showResult('upload-result', 'è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶', 'error');
        return;
      }

      showResult('upload-result', 'æ­£åœ¨ä¸Šä¼ ...', 'info');
      
      const formData = new FormData();
      formData.append('file', fileInput.files[0]);
      
      try {
        const response = await fetch(`${API_BASE}/api/v1/clothes/upload?user_id=1`, {
          method: 'POST',
          body: formData
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showResult('upload-result', 
            `âœ… ä¸Šä¼ æˆåŠŸï¼\nå“åº”: ${JSON.stringify(data, null, 2)}`, 
            'success'
          );
        } else {
          showResult('upload-result', 
            `âŒ ä¸Šä¼ å¤±è´¥ï¼\nçŠ¶æ€ç : ${response.status}\nå“åº”: ${JSON.stringify(data, null, 2)}`, 
            'error'
          );
        }
      } catch (error) {
        showResult('upload-result', 
          `âŒ ä¸Šä¼ è¯·æ±‚å¤±è´¥ï¼
é”™è¯¯: ${error.message}

å¯èƒ½åŸå› ï¼š
1. åç«¯æœªå¯åŠ¨
2. ç«¯å£é…ç½®é”™è¯¯
3. CORS é—®é¢˜`, 
          'error'
        );
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
    window.onload = () => {
      checkConfig();
    };
  </script>
</body>
</html>
